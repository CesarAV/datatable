<<<<<<< HEAD
<<<<<<< 852cf7221f24a4cf76b614e776f0f09fdb9bdd19
"use strict";var DataTable=function(table,opts){this.options={};this.table=table;this.currentPage=0;this.currentStart=0;this.filterIndex=[];for(var k in DataTable.defaultOptions){if(DataTable.defaultOptions.hasOwnProperty(k)){if(opts.hasOwnProperty(k)){this.options[k]=opts[k]}else{this.options[k]=DataTable.defaultOptions[k]}}}if(opts.hasOwnProperty("data")){this.options.data=opts.data}if(this.options.nbColumns<0){this.options.nbColumns=this.table.tHead.rows[0].cells.length}this.pagingDivs=document.querySelectorAll(this.options.pagingDivSelector);for(var i=0;i<this.pagingDivs.length;++i){var div=this.pagingDivs[i];this.addClass(div,"pagination-datatables");this.addClass(div,this.options.pagingDivClass);var ul=document.createElement("ul");this.addClass(ul,this.options.pagingListClass);div.appendChild(ul)}this.pagingLists=document.querySelectorAll(this.options.pagingDivSelector+" ul");this.counterDivs=document.querySelectorAll(this.options.counterDivSelector);this.loadingDiv=document.querySelector(this.options.loadingDivSelector);var dataTable=this;if(!this.table.tHead){this.table.tHead=document.createElement("thead");this.table.appendChild(this.table.rows[0])}if(this.options.forceStrings){this.options.dataTypes=false}var ths=this.table.tHead.rows[0].cells;if(!this.table.tBodies[0]){this.table.tBodies[0]=document.createElement("tbody")}if(this.options.data instanceof Array){this.data=this.options.data}else if(this.options.data instanceof Object){var ajaxOptions=DataTable.defaultAjaxOptions;for(var k in this.options.data){ajaxOptions[k]=this.options.data[k]}this.options.data=ajaxOptions;var fetchData=true;if(fetchData){if(this.table.dataset.size!==undefined){this.options.data.size=parseInt(this.table.dataset.size,10)}this.data=[];if(this.options.data.size!==undefined){this.loadingDiv.innerHTML='<div class="progress datatable-load-bar">'+'<div class="progress-bar progress-bar-striped active" style="width: 0%;">'+"</div></div>";if(this.options.data.allInOne){this.getAjaxDataAsync(true)}else{for(var i=0;i<this.options.data.size;i+=this.options.pageSize*this.options.pagingNumberOfPages){this.getAjaxDataAsync(i)}}}else{this.loadingDiv.innerHTML='<div class="progress datatable-load-bar">'+'<div class="progress-bar progress-bar-striped active" style="width: 0%;">'+"</div></div>";this.getAjaxDataAsync(0,true)}}}else if(this.table.tBodies[0].rows.length>0){this.data=[];var rows=this.table.tBodies[0].rows;var nCols=rows[0].cells.length;for(var i=0;i<rows.length;++i){this.data.push([])}for(var j=0;j<nCols;++j){var dt=function(x){return x};if(this.options.dataTypes instanceof Array){switch(this.options.dataTypes[j]){case"int":dt=parseInt;break;case"float":case"double":dt=parseFloat;break;case"date":case"datetime":dt=function(x){return new Date(x)};break;case false:case true:case"string":case"str":dt=function(x){return x};break;default:dt=this.options.dataTypes[j]}}for(var i=0;i<rows.length;++i){this.data[i].push(dt(rows[i].cells[j].innerHTML.trim()))}}if(this.options.dataTypes===true){for(var c=0;c<this.data[0].length;++c){var isNumeric=true;for(var i=0;i<this.data.length;++i){if(this.data[i][c]!==""&&!(this.data[i][c]-parseFloat(this.data[i][c])+1>=0)){isNumeric=false}}if(isNumeric){for(var i=0;i<this.data.length;++i){if(this.data[i][c]!==""){this.data[i][c]=parseFloat(this.data[i][c])}}}}}}this.createSort();this.createFilter();this.triggerSort();this.filter()};DataTable.prototype={constructor:DataTable,addClass:function(node,classes){if(typeof classes==="string"){classes=classes.split(" ")}classes.forEach(function(c){if(!c){return}node.classList.add(c)})},removeNode:function(node){if(node){node.parentNode.removeChild(node)}},setRefreshTimeout:function(){if(this.options.data.refresh){clearTimeout(this.refreshTimeOut);this.refreshTimeOut=setTimeout(function(datatable){return function(){datatable.getAjaxDataAsync(0,true)}}(this),this.options.data.refresh)}},hideLoadingDivs:function(){this.removeNode(this.loadingDiv)},updateLoadingDivs:function(){if(this.data.length>=this.options.data.size){this.setRefreshTimeout();this.hideLoadingDivs()}else{this.loadingDiv.querySelector("div.progress .progress-bar").style.width=parseInt(100*this.data.length/this.options.data.size,10)+"%"}},getAjaxDataAsync:function(start,recursive){if(typeof recursive==="undefined"){recursive=false}if(recursive&&typeof this.syncData==="undefined"){this.syncData={data:[],toAdd:[],toUpdate:{},toDelete:[]}}var xhr=new XMLHttpRequest;xhr.timeout=this.options.data.timeout;xhr.onreadystatechange=function(datatable,start,recursive){return function(){if(this.readyState==4){switch(this.status){case 200:if(recursive){if(this.response.length>0){datatable.syncData.data=datatable.syncData.data.concat(this.response);datatable.getAjaxDataAsync(start+datatable.options.pageSize*datatable.options.pagingNumberOfPages,true)}else{var syncData=datatable.syncData;delete datatable.syncData;datatable.data=syncData.data;datatable.addRows(syncData.toAdd);syncData.toDelete.forEach(function(e){if(e instanceof Function){datatable.deleteAll(e)}else{datatable.deleteRow(e)}});for(var id in syncData.toUpdate){datatable.updateRow(id,syncData.toUpdate[id])}datatable.sort(true);datatable.setRefreshTimeout()}}else{datatable.data=datatable.data.concat(this.response);datatable.updateLoadingDivs();datatable.sort(true)}break;case 404:case 500:console.log("ERROR: "+this.status+" - "+this.statusText);console.log(xhr);break;default:datatable.getAjaxDataAsync(start,recursive);break}}}}(this,start,recursive);var url=this.options.data.url;var limit=this.options.pageSize*this.options.pagingNumberOfPages;var formdata=new FormData;if(start!==true){if(this.options.data.type.toUpperCase()=="GET"){url+="?start="+start+"&limit="+limit}else{formdata.append("offset",start);formdata.append("limit",limit)}}xhr.open(this.options.data.type,url,true);xhr.responseType="json";xhr.send(formdata)},getLastPageNumber:function(){return parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10)},updatePaging:function(){var nbPages=this.options.pagingNumberOfPages;var dataTable=this;var cp=parseInt(this.currentStart/this.options.pageSize,10)+1;var lp=this.getLastPageNumber();var start;var end;var first=this.filterIndex.length?this.currentStart+1:0;var last=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;if(cp<nbPages/2){start=1}else if(cp>=lp-nbPages/2){start=lp-nbPages+1;if(start<1){start=1}}else{start=parseInt(cp-nbPages/2+1,10)}if(start+nbPages<lp+1){end=start+nbPages-1}else{end=lp}for(var i=0;i<this.pagingLists.length;++i){var childs=[];if(dataTable.options.firstPage){var li=document.createElement("li");if(cp===1){li.classList.add("active")}li.innerHTML='<a data-page="first">'+dataTable.options.firstPage+"</a>";childs.push(li)}if(dataTable.options.prevPage){var li=document.createElement("li");if(cp===1){li.classList.add("active")}li.innerHTML='<a data-page="prev">'+dataTable.options.prevPage+"</a>";childs.push(li)}if(dataTable.options.pagingPages){var _childs=this.options.pagingPages.call(this.table,start,end,cp,first,last);if(_childs instanceof Array){childs=childs.concat(_childs)}else{childs.push(_childs)}}else{for(var k=start;k<=end;k++){var li=document.createElement("li");if(k===cp){li.classList.add("active")}li.innerHTML='<a data-page="'+k+'">'+k+"</a>";childs.push(li)}}if(dataTable.options.nextPage){var li=document.createElement("li");if(cp===lp||lp===0){li.classList.add("active")}li.innerHTML='<a data-page="next">'+dataTable.options.nextPage+"</a>";childs.push(li)}if(dataTable.options.lastPage){var li=document.createElement("li");if(cp===lp||lp===0){li.classList.add("active")}li.innerHTML='<a data-page="last">'+dataTable.options.lastPage+"</a>";childs.push(li)}this.pagingLists[i].innerHTML="";childs.forEach(function(e){if(e.childNodes.length>0){e.childNodes[0].addEventListener("click",function(){if(this.parentNode.classList.contains("active")||typeof this.dataset.page==="undefined"){return}switch(this.dataset.page){case"first":dataTable.loadPage(1);break;case"prev":dataTable.loadPage(cp-1);break;case"next":dataTable.loadPage(cp+1);break;case"last":dataTable.loadPage(lp);break;default:dataTable.loadPage(parseInt(parseInt(this.dataset.page),10))}},false)}this.pagingLists[i].appendChild(e)},this)}},updateCounter:function(){var cp=this.filterIndex.length?parseInt(this.currentStart/this.options.pageSize,10)+1:0;var lp=parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10);var first=this.filterIndex.length?this.currentStart+1:0;var last=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;for(var i=0;i<this.counterDivs.length;++i){this.counterDivs[i].innerHTML=this.options.counterText.call(this.table,cp,lp,first,last,this.filterIndex.length,this.data.length)}},getSortFunction:function(){if(this.options.sort===false){return false}if(this.options.sort instanceof Function){return this.options.sort}if(this.data.length===0||!(this.options.sortKey in this.data[0])){return false}var key=this.options.sortKey;var asc=this.options.sortDir==="asc";if(this.options.sort[key]instanceof Function){return function(s){return function(a,b){var vala=a[key],valb=b[key];return asc?s(vala,valb):-s(vala,valb)}}(this.options.sort[key])}return function(a,b){var vala=a[key],valb=b[key];if(vala>valb){return asc?1:-1}if(vala<valb){return asc?-1:1}return 0}},destroyFilter:function(){this.removeNode(this.table.querySelector(".datatable-filter-line"))},changePlaceHolder:function(){var placeholder=this.options.filterText?this.options.filterText:"";var inputTexts=this.table.querySelectorAll('.datatable-filter-line input[type="text"]');for(var i=0;i<inputTexts.length;++i){inputTexts[i].placeholder=placeholder}},createTextFilter:function(field){var opt=this.options.filters[field];var input=opt instanceof HTMLInputElement?opt:document.createElement("input");input.type="text";if(this.options.filterText){input.placeholder=this.options.filterText}this.addClass(input,"datatable-filter datatable-input-text");input.dataset.filter=field;this.filterVals[field]="";var typewatch=function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms)}}();input.onkeyup=function(datatable){return function(){var val=this.value.toUpperCase();var field=this.dataset.filter;typewatch(function(){datatable.filterVals[field]=val;datatable.filter()},300)}}(this);input.onkeydown=input.onkeyup;var regexp=opt==="regexp"||input.dataset.regexp;if(opt instanceof Function){this.addFilter(field,opt)}else if(regexp){this.addFilter(field,function(data,val){return new RegExp(val).test(String(data))})}else{this.addFilter(field,function(data,val){return String(data).toUpperCase().indexOf(val)!==-1})}this.addClass(input,this.options.filterInputClass);return input},_isIn:function(val,arr){var found=false;for(var i=0;i<arr.length&&!found;++i){found=arr[i]==val}return found},_index:function(v,a){if(a===undefined||a===null){return-1}var index=-1;for(var i=0;i<a.length&&index==-1;++i){if(a[i]===v)index=i}return index},_keys:function(obj){if(obj===undefined||obj===null){return undefined}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k))keys.push(k)}return keys},createSelectFilter:function(field){var opt=this.options.filters[field];var values={},selected=[],multiple=false,empty=true,emptyValue=this.options.filterEmptySelect;var tag=false;if(opt instanceof HTMLSelectElement){tag=opt}else if(opt instanceof Object&&"element"in opt&&opt.element){tag=opt.element}if(opt instanceof HTMLSelectElement||opt==="select"){values=this.getFilterOptions(field)}else{multiple="multiple"in opt&&opt.multiple===true;empty="empty"in opt&&opt.empty;emptyValue="empty"in opt&&typeof opt.empty==="string"?opt.empty:this.options.filterEmptySelect;if("values"in opt){if(opt.values==="auto"){values=this.getFilterOptions(field)}else{values=opt.values}if("default"in opt){selected=opt["default"]}else if(multiple){selected=[];for(var k in values){if(values[k]instanceof Object){selected=selected.concat(this._keys(values[k]))}else{selected.push(k)}}}else{selected=[]}if(!(selected instanceof Array)){selected=[selected]}}else{values=opt;selected=multiple?this._keys(values):[]}}var select=tag?tag:document.createElement("select");if(multiple){select.multiple=true}if(opt["default"]){select.dataset["default"]=opt["default"]}this.addClass(select,"datatable-filter datatable-select");select.dataset.filter=field;if(empty){var option=document.createElement("option");option.dataset.empty=true;option.value="";option.innerHTML=emptyValue;select.appendChild(option)}var allKeys=[];for(var key in values){if(values[key]instanceof Object){var optgroup=document.createElement("optgroup");optgroup.label=key;for(var skey in values[key]){if(values[key].hasOwnProperty(skey)){allKeys.push(skey);var option=document.createElement("option");option.value=skey;option.selected=this._isIn(skey,selected);option.innerHTML=values[key][skey];optgroup.appendChild(option)}}select.appendChild(optgroup)}else{allKeys.push(key);var option=document.createElement("option");option.value=key;option.selected=this._isIn(key,selected);option.innerHTML=values[key];select.appendChild(option)}}var val=select.value;if(multiple){val=[];for(var i=0;i<select.options.length;++i){if(select.options[i].selected){val.push(select.options[i].value)}}}this.filterVals[field]=multiple?val:empty&&!val?allKeys:[val];select.onchange=function(allKeys,multiple,empty,datatable){return function(){var val=this.value;if(multiple){val=[];for(var i=0;i<this.options.length;++i){if(this.options[i].selected){val.push(this.options[i].value)}}}var field=this.dataset.filter;datatable.filterVals[field]=multiple?val:empty&&!val?allKeys:[val];datatable.filter()}}(allKeys,multiple,empty,this);if(opt instanceof Object&&opt.fn instanceof Function){this.addFilter(field,opt.fn);select.dataset.filterType="function"}else{this.addFilter(field,function(aKeys,datatable){return function(data,val){if(!val){return false}if(val==aKeys&&!data){return true}return datatable._isIn(data,val)}}(allKeys,this));select.dataset.filterType="default"}this.addClass(select,this.options.filterSelectClass);return select},createFilter:function(){this.filters=[];this.filterTags=[];this.filterVals=[];if(this.options.filter==="*"){var nThs=this.table.tHead.rows[0].cells.length;this.options.filter=[];while(nThs--){this.options.filter.push(true)}}if(this.options.filters){var filterLine=false;var tr=document.createElement("tr");tr.classList.add("datatable-filter-line");for(var field in this.options.filters){if(this.options.filters.hasOwnProperty(field)){var td=document.createElement("td");if(this.options.filters[field]!==false){var opt=this.options.filters[field];var input=opt===true||opt==="regexp"||opt==="input"||opt instanceof Function||opt instanceof HTMLInputElement;var filter=input?this.createTextFilter(field):this.createSelectFilter(field);this.filterTags[field]=filter;if(!document.contains(filter)){td.classList.add("datatable-filter-cell");td.appendChild(filter)}}if(!(this.options.filters[field]instanceof Object)||!this.options.filters[field].noColumn){tr.appendChild(td)}}}if(tr.querySelectorAll("td.datatable-filter-cell").length>0){this.table.tHead.appendChild(tr)}}},filter:function(keepCurrentPage){if(typeof keepCurrentPage==="undefined"){keepCurrentPage=false}var oldCurrentStart=this.currentStart;this.currentStart=0;this.filterIndex=[];for(var i=0;i<this.data.length;i++){if(this.checkFilter(this.data[i])){this.filterIndex.push(i)}}if(keepCurrentPage){this.currentStart=oldCurrentStart;while(this.currentStart>=this.filterIndex.length){this.currentStart-=this.options.pageSize}if(this.currentStart<0){this.currentStart=0}}if(this.options.filterSelectOptions&&this.filterIndex.length>0){var dtable=this;var allKeys=[];for(var j=0;j<this.data[0].length;++j){allKeys.push({})}for(var i=0;i<this.filterIndex.length;++i){var row=this.data[this.filterIndex[i]];for(var j=0;j<row.length;++j){allKeys[j][row[j]]=true}}for(var k=0;k<allKeys.length;++k){var keys=this._keys(allKeys[k]);if(this.filterTags[k]&&this.filterTags[k]instanceof HTMLSelectElement&&this.filterTags[k].dataset.filterType=="default"){var options=this.filterTags[k].childNodes;for(var i=0;i<options.length;++i){if(!options[i].dataset.empty){options[i].style.display=dtable._isIn(options[i].value,keys)?"block":"none"}}}}}this.refresh()},resetFilters:function(){var dtable=this;this.filterTags.forEach(function(e){var field=e.dataset.filter;if(e instanceof HTMLInputElement){e.value="";dtable.filterVals[field]=""}else{if(e.multiple){var allKeys=[];for(var i=0;i<e.childNodes.length;++i){e.childNodes[i].selected=true;allKeys.push(e.childNodes[i].value)}dtable.filterVals[field]=allKeys}else if(e.dataset["default"]&&e.querySelector('option[value="'+e.dataset["default"]+'"]').length>0){for(var i=0;i<e.childNodes.length;++i){e.childNodes[i].selected=e.childNodes[i].value==e.dataset["default"]}dtable.filterVals[field]=[e.dataset["default"]]}else if(e.childNodes.length>0){e.childNodes[0].selected=true;for(var i=1;i<e.childNodes.length;++i){e.childNodes[i].selected=false}if(e.childNodes[0].dataset.empty){var allKeys=[];for(var i=1;i<e.childNodes.length;++i){allKeys.push(e.childNodes[i].value)}dtable.filterVals[field]=allKeys}else{dtable.filterVals[field]=[e.childNodes[0].value]}}}});this.filter()},stripTags:function(str){var e=document.createElement("div");e.innerHTML=str;return e.textContent||e.innerText},checkFilter:function(data){var ok=true;for(var fk in this.filters){var currentData=fk[0]==="_"?data:data[fk];if(typeof currentData==="string"){currentData=this.stripTags(currentData)}if(!this.filters[fk](currentData,this.filterVals[fk])){ok=false;break}}return ok},addFilter:function(field,filter){this.filters[field]=filter},getFilterOptions:function(field){var options={},values=[];for(var key in this.data){if(this.data[key][field]!==""){values.push(this.data[key][field])}}values.sort();for(var i in values){if(values.hasOwnProperty(i)){var txt=this.stripTags(values[i]);options[txt]=txt}}return options},destroySort:function(){$("thead th").removeClass("sorting sorting-asc sorting-desc").unbind("click.datatable").removeData("sort")},createSort:function(){var dataTable=this;if(!(this.options.sort instanceof Function)){var countTH=0;var ths=this.table.tHead.rows[0].cells;for(var i=0;i<ths.length;++i){if(ths[i].dataset.sort){dataTable.options.sort=true}else if(dataTable.options.sort==="*"){ths[i].dataset.sort=countTH}else{var key;if(dataTable.options.sort instanceof Array){key=countTH}else if(dataTable.options.sort instanceof Object){key=dataTable._keys(dataTable.options.sort)[countTH]}if(key!==undefined&&dataTable.options.sort[key]){ths[i].dataset.sort=key}}if(ths[i].dataset.sort!==undefined){ths[i].classList.add("sorting")}countTH++;ths[i].addEventListener("click",function(){if(this.dataset.sort){if(this.classList.contains("sorting-asc")){dataTable.options.sortDir="desc";this.classList.remove("sorting-asc");this.classList.add("sorting-desc")}else if(this.classList.contains("sorting-desc")){dataTable.options.sortDir="asc";this.classList.remove("sorting-desc");this.classList.add("sorting-asc")}else{var oths=this.parentNode.cells;for(var j=0;j<oths.length;j++){oths[j].classList.remove("sorting-desc");oths[j].classList.remove("sorting-asc")}dataTable.options.sortDir="asc";dataTable.options.sortKey=this.dataset.sort;this.classList.add("sorting-asc")}dataTable.sort();dataTable.refresh()}},false)}}},triggerSort:function(){if(this.options.sort instanceof Function){this.sort();this.refresh()}else if(this.options.sortKey!==false){var ths=this.table.tHead.rows[0].cells;var th;for(var j=0;j<ths.length;j++){ths[j].classList.remove("sorting-desc");ths[j].classList.remove("sorting-asc");if(ths[j].dataset.sort===this.options.sortKey){th=ths[j]}}if(th!==undefined){th.classList.add("sorting-"+this.options.sortDir);this.sort();this.refresh()}}},sort:function(keepCurrentPage){var fnSort=this.getSortFunction();if(fnSort!==false){this.data.sort(fnSort)}this.filter(keepCurrentPage)},identify:function(id,data){if(this.options.identify===false){return false}if(this.options.identify instanceof Function){return this.options.identify(id,data)}return data[this.options.identify]==id},indexOf:function(id){var index=-1;for(var i=0;i<this.data.length&&index===-1;i++){if(this.identify(id,this.data[i])){index=i}}return index},row:function(id){if(this.options.identify===true){return this.data[id]}return this.data[this.indexOf(id)]},all:function(filter){if(typeof filter==="undefined"||filter===true){return this.data}var returnData=[];for(var i=0;i<this.data.length;++i){if(filter(this.data[i])){returnData.push(this.data[i])}}return returnData},addRow:function(data){this.data.push(data);if(typeof this.syncData!=="undefined"){this.syncData.toAdd.push(data)}this.sort();this.filter();this.currentStart=parseInt(this._index(this._index(data,this.data),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize;this.refresh()},addRows:function(data){this.data=this.data.concat(data);if(typeof this.syncData!=="undefined"){this.syncData.toAdd=this.syncData.toAdd.concat(data)}this.sort();this.filter();this.currentStart=parseInt(this._index(this._index(data,this.data),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize;this.refresh()},deleteRow:function(id){var oldCurrentStart=this.currentStart;var index=this.indexOf(id);if(index===-1){console.log("No data found with id: "+id);return}this.data.splice(index,1);if(typeof this.syncData!=="undefined"){this.syncData.toDelete.push(id)}this.filter();if(oldCurrentStart<this.filterIndex.length){this.currentStart=oldCurrentStart}else{this.currentStart=oldCurrentStart-this.options.pageSize;if(this.currentStart<0){this.currentStart=0}}this.refresh()},deleteAll:function(filter){var oldCurrentStart=this.currentStart;var newData=[];if(typeof this.syncData!=="undefined"){this.syncData.toDelete.push(filter)}for(var i=0;i<this.data.length;++i){if(!filter(this.data[i])){newData.push(this.data[i])}}this.data=newData;this.filter();if(oldCurrentStart<this.filterIndex.length){this.currentStart=oldCurrentStart}else{this.currentStart=oldCurrentStart-this.options.pageSize;if(this.currentStart<0){this.currentStart=0}}this.refresh()},updateRow:function(id,data){var index=this.indexOf(id);if(typeof this.syncData!=="undefined"){this.syncData.toUpdate[id]=data}if(index!==-1){if(id in data){delete data[id]}for(var key in this.data[index]){if(key in data){this.data[index][key]=data[key]}}this.sort();this.filter();this.currentStart=parseInt(this._index(this.indexOf(id),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize;this.refresh()}},loadPage:function(page){var oldPage=this.currentStart/this.options.pageSize;if(page<1){page=1}else if(page>this.getLastPageNumber()){page=this.getLastPageNumber()}this.currentStart=(page-1)*this.options.pageSize;this.refresh();this.options.onChange.call(this.table,oldPage+1,page)},getCurrentPage:function(){return this.currentStart/this.options.pageSize+1},refresh:function(){this.options.beforeRefresh.call(this.table);this.updatePaging();this.updateCounter();this.table.tBodies[0].innerHTML="";if(this.currentStart>=this.currentDataLength){this.table.tBodies[0].innerHTML='<tr><td colspan="'+this.options.nbColumns+'">'+'<div class="progress progress-striped active">'+'<div class="bar" style="width: 100%;"></div>'+"</div></div></tr>";return}for(var i=0;i<this.options.pageSize&&i+this.currentStart<this.filterIndex.length;i++){var index=this.filterIndex[this.currentStart+i];var data=this.data[index];this.table.tBodies[0].appendChild(this.options.lineFormat.call(this.table,index,data))}this.options.afterRefresh.call(this.table)},setOption:function(key,val){if(key in this.options){this.options[key]=val;if(key==="sort"){this.destroySort();this.createSort();this.triggerSort()}if(key==="sortKey"||key==="sortDir"){this.sort()}if(key==="filters"){this.destroyFilter();this.createFilter()}if(key==="filterText"){this.changePlaceHolder()}this.filter()}},setOptions:function(options){for(var key in options){if(key in this.options){this.options[key]=options[key]}}if("sort"in options){this.destroySort();this.createSort();this.triggerSort()}else if("sortKey"in options||"sortDir"in options){this.sort()}if("filters"in options){this.destroyFilter();this.createFilter()}if("filterText"in options){this.changePlaceHolder()}this.filter()},destroy:function(){if(this.refreshTimeOut!==undefined){clearTimeout(this.refreshTimeOut)}this.destroySort();for(var i=0;i<this.pagingDivs.length;++i){this.pagingDivs[i].classList.remove("pagination-datatable");this.pagingDivs[i].classList.remove(this.options.pagingDivClass);this.pagingDivs[i].innerHTML=""}this.destroyFilter();this.table.classList.remove(this.options.tableClass);this.removeNode(this.table.tBodies[0]);this.table.appendChild(document.createElement("tbody"));for(var i=0;i<this.data.length;i++){var index=this.filterIndex[this.currentStart+i];var data=this.data[index];this.table.tBodies[0].appendChild(this.options.lineFormat.call(this.table,index,data))}}};DataTable.defaultOptions={forceStrings:false,tableClass:"datatable",pagingDivSelector:".paging",pagingDivClass:"text-center",pagingListClass:"pagination",counterDivSelector:".counter",loadingDivSelector:".loading",sort:false,sortKey:false,sortDir:"asc",nbColumns:-1,pageSize:20,pagingNumberOfPages:9,identify:false,onChange:function(oldPage,newPage){},counterText:function(currentPage,totalPage,firstRow,lastRow,totalRow,totalRowUnfiltered){var counterText="Page "+currentPage+" on "+totalPage+". Showing "+firstRow+" to "+lastRow+" of "+totalRow+" entries";if(totalRow!=totalRowUnfiltered){counterText+=" (filtered from "+totalRowUnfiltered+" total entries)"}counterText+=".";return counterText},firstPage:"&lt;&lt;",prevPage:"&lt;",pagingPages:false,nextPage:"&gt;",lastPage:"&gt;&gt;",dataTypes:true,filters:{},filterText:"Search... ",filterEmptySelect:"",filterSelectOptions:false,filterInputClass:"form-control",filterSelectClass:"form-control",beforeRefresh:function(){},afterRefresh:function(){},lineFormat:function(id,data){var res=document.createElement("tr");res.dataset.id=id;for(var key in data){if(data.hasOwnProperty(key)){res.innerHTML+="<td>"+data[key]+"</td>"}}return res}};DataTable.defaultAjaxOptions={url:null,size:null,refresh:false,allInOne:false,timeout:2e3};
=======
"use strict";var DataTable=function(e,t){this.options={},this.table=e,this.currentPage=0,this.currentStart=0,this.filterIndex=[];for(var n in DataTable.defaultOptions)DataTable.defaultOptions.hasOwnProperty(n)&&(t.hasOwnProperty(n)?this.options[n]=t[n]:this.options[n]=DataTable.defaultOptions[n]);t.hasOwnProperty("data")&&(this.options.data=t.data),this.options.nbColumns<0&&(this.options.nbColumns=this.table.tHead.rows[0].cells.length),this.pagingDivs=document.querySelectorAll(this.options.pagingDivSelector);for(var r=0;r<this.pagingDivs.length;++r){var i=this.pagingDivs[r];this.addClass(i,"pagination-datatables"),this.addClass(i,this.options.pagingDivClass);var s=document.createElement("ul");this.addClass(s,this.options.pagingListClass),i.appendChild(s)}this.pagingLists=document.querySelectorAll(this.options.pagingDivSelector+" ul"),this.counterDivs=document.querySelectorAll(this.options.counterDivSelector),this.loadingDiv=document.querySelector(this.options.loadingDivSelector);var o=this;this.table.tHead||(this.table.tHead=document.createElement("thead"),this.table.appendChild(this.table.rows[0])),this.options.forceStrings&&(this.options.dataTypes=!1);var u=this.table.tHead.rows[0].cells;this.table.tBodies[0]||(this.table.tBodies[0]=document.createElement("tbody"));if(this.options.data instanceof Array)this.data=this.options.data;else if(this.options.data instanceof Object){var a=DataTable.defaultAjaxOptions;for(var n in this.options.data)a[n]=this.options.data[n];this.options.data=a;var f=!0;if(f){this.table.dataset.size!==undefined&&(this.options.data.size=parseInt(this.table.dataset.size,10)),this.data=[];if(this.options.data.size!==undefined){this.loadingDiv.innerHTML='<div class="progress datatable-load-bar"><div class="progress-bar progress-bar-striped active" style="width: 0%;"></div></div>';if(this.options.data.allInOne)this.getAjaxDataAsync(!0);else for(var r=0;r<this.options.data.size;r+=this.options.pageSize*this.options.pagingNumberOfPages)this.getAjaxDataAsync(r)}else this.loadingDiv.innerHTML='<div class="progress datatable-load-bar"><div class="progress-bar progress-bar-striped active" style="width: 0%;"></div></div>',this.getAjaxDataAsync(0,!0)}}else if(this.table.tBodies[0].rows.length>0){this.data=[];var l=this.table.tBodies[0].rows,c=l[0].cells.length;for(var r=0;r<l.length;++r)this.data.push([]);for(var h=0;h<c;++h){var p=function(e){return e};if(this.options.dataTypes instanceof Array)switch(this.options.dataTypes[h]){case"int":p=parseInt;break;case"float":case"double":p=parseFloat;break;case"date":case"datetime":p=function(e){return new Date(e)};break;case!1:case!0:case"string":case"str":p=function(e){return e};break;default:p=this.options.dataTypes[h]}for(var r=0;r<l.length;++r)this.data[r].push(p(l[r].cells[h].innerHTML.trim()))}if(this.options.dataTypes===!0)for(var d=0;d<this.data[0].length;++d){var v=!0;for(var r=0;r<this.data.length;++r)this.data[r][d]!==""&&!(this.data[r][d]-parseFloat(this.data[r][d])+1>=0)&&(v=!1);if(v)for(var r=0;r<this.data.length;++r)this.data[r][d]!==""&&(this.data[r][d]=parseFloat(this.data[r][d]))}}this.createSort(),this.createFilter(),this.triggerSort(),this.filter()};DataTable.prototype={constructor:DataTable,addClass:function(e,t){typeof t=="string"&&(t=t.split(" ")),t.forEach(function(t){if(!t)return;e.classList.add(t)})},removeNode:function(e){e&&e.parentNode.removeChild(e)},setRefreshTimeout:function(){this.options.data.refresh&&(clearTimeout(this.refreshTimeOut),this.refreshTimeOut=setTimeout(function(e){return function(){e.getAjaxDataAsync(0,!0)}}(this),this.options.data.refresh))},hideLoadingDivs:function(){this.removeNode(this.loadingDiv)},updateLoadingDivs:function(){this.data.length>=this.options.data.size?(this.setRefreshTimeout(),this.hideLoadingDivs()):this.loadingDiv.querySelector("div.progress .progress-bar").style.width=parseInt(100*this.data.length/this.options.data.size,10)+"%"},getAjaxDataAsync:function(e,t){typeof t=="undefined"&&(t=!1),t&&typeof this.syncData=="undefined"&&(this.syncData={data:[],toAdd:[],toUpdate:{},toDelete:[]});var n=new XMLHttpRequest;n.timeout=this.options.data.timeout,n.onreadystatechange=function(e,t,r){return function(){if(this.readyState==4)switch(this.status){case 200:if(r)if(this.response.length>0)e.syncData.data=e.syncData.data.concat(this.response),e.getAjaxDataAsync(t+e.options.pageSize*e.options.pagingNumberOfPages,!0);else{var i=e.syncData;delete e.syncData,e.data=i.data,e.addRows(i.toAdd),i.toDelete.forEach(function(t){t instanceof Function?e.deleteAll(t):e.deleteRow(t)});for(var s in i.toUpdate)e.updateRow(s,i.toUpdate[s]);e.sort(!0),e.setRefreshTimeout()}else e.data=e.data.concat(this.response),e.updateLoadingDivs(),e.sort(!0);break;case 404:case 500:console.log("ERROR: "+this.status+" - "+this.statusText),console.log(n);break;default:e.getAjaxDataAsync(t,r)}}}(this,e,t);var r=this.options.data.url,i=this.options.pageSize*this.options.pagingNumberOfPages,s=new FormData;e!==!0&&(this.options.data.type.toUpperCase()=="GET"?r+="?start="+e+"&limit="+i:(s.append("offset",e),s.append("limit",i))),n.open(this.options.data.type,r,!0),n.responseType="json",n.send(s)},getLastPageNumber:function(){return parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10)},updatePaging:function(){var e=this.options.pagingNumberOfPages,t=this,n=parseInt(this.currentStart/this.options.pageSize,10)+1,r=this.getLastPageNumber(),i,s,o=this.filterIndex.length?this.currentStart+1:0,u=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;n<e/2?i=1:n>=r-e/2?(i=r-e+1,i<1&&(i=1)):i=parseInt(n-e/2+1,10),i+e<r+1?s=i+e-1:s=r;for(var a=0;a<this.pagingLists.length;++a){var f=[];if(t.options.firstPage){var l=document.createElement("li");n===1&&l.classList.add("active"),l.innerHTML='<a data-page="first">'+t.options.firstPage+"</a>",f.push(l)}if(t.options.prevPage){var l=document.createElement("li");n===1&&l.classList.add("active"),l.innerHTML='<a data-page="prev">'+t.options.prevPage+"</a>",f.push(l)}if(t.options.pagingPages){var c=this.options.pagingPages.call(this.table,i,s,n,o,u);c instanceof Array?f=f.concat(c):f.push(c)}else for(var h=i;h<=s;h++){var l=document.createElement("li");h===n&&l.classList.add("active"),l.innerHTML='<a data-page="'+h+'">'+h+"</a>",f.push(l)}if(t.options.nextPage){var l=document.createElement("li");(n===r||r===0)&&l.classList.add("active"),l.innerHTML='<a data-page="next">'+t.options.nextPage+"</a>",f.push(l)}if(t.options.lastPage){var l=document.createElement("li");(n===r||r===0)&&l.classList.add("active"),l.innerHTML='<a data-page="last">'+t.options.lastPage+"</a>",f.push(l)}this.pagingLists[a].innerHTML="",f.forEach(function(e){e.childNodes.length>0&&e.childNodes[0].addEventListener("click",function(){if(this.parentNode.classList.contains("active")||typeof this.dataset.page=="undefined")return;switch(this.dataset.page){case"first":t.loadPage(1);break;case"prev":t.loadPage(n-1);break;case"next":t.loadPage(n+1);break;case"last":t.loadPage(r);break;default:t.loadPage(parseInt(parseInt(this.dataset.page),10))}},!1),this.pagingLists[a].appendChild(e)},this)}},updateCounter:function(){var e=this.filterIndex.length?parseInt(this.currentStart/this.options.pageSize,10)+1:0,t=parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10),n=this.filterIndex.length?this.currentStart+1:0,r=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;for(var i=0;i<this.counterDivs.length;++i)this.counterDivs[i].innerHTML=this.options.counterText.call(this.table,e,t,n,r,this.filterIndex.length,this.data.length)},getSortFunction:function(){if(this.options.sort===!1)return!1;if(this.options.sort instanceof Function)return this.options.sort;if(this.data.length!==0&&this.options.sortKey in this.data[0]){var e=this.options.sortKey,t=this.options.sortDir==="asc";return this.options.sort[e]instanceof Function?function(n){return function(r,i){var o=r[e],u=i[e];return t?n(o,u):-n(o,u)}}(this.options.sort[e]):function(n,r){var i=n[e],s=r[e];return i>s?t?1:-1:i<s?t?-1:1:0}}return!1},destroyFilter:function(){this.removeNode(this.table.querySelector(".datatable-filter-line"))},changePlaceHolder:function(){var e=this.options.filterText?this.options.filterText:"",t=this.table.querySelectorAll('.datatable-filter-line input[type="text"]');for(var n=0;n<t.length;++n)t[n].placeholder=e},createTextFilter:function(e){var t=this.options.filters[e],n=t instanceof HTMLInputElement?t:document.createElement("input");n.type="text",this.options.filterText&&(n.placeholder=this.options.filterText),this.addClass(n,"datatable-filter datatable-input-text"),n.dataset.filter=e,this.filterVals[e]="";var r=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}();n.onkeyup=function(e){return function(){var t=this.value.toUpperCase(),n=this.dataset.filter;r(function(){e.filterVals[n]=t,e.filter()},300)}}(this),n.onkeydown=n.onkeyup;var i=t==="regexp"||n.dataset.regexp;return t instanceof Function?this.addFilter(e,t):i?this.addFilter(e,function(e,t){return(new RegExp(t)).test(String(e))}):this.addFilter(e,function(e,t){return String(e).toUpperCase().indexOf(t)!==-1}),this.addClass(n,this.options.filterInputClass),n},_isIn:function(e,t){var n=!1;for(var r=0;r<t.length&&!n;++r)n=t[r]==e;return n},_index:function(e,t){if(t===undefined||t===null)return-1;var n=-1;for(var r=0;r<t.length&&n==-1;++r)t[r]===e&&(n=r);return n},_keys:function(e){if(e===undefined||e===null)return undefined;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},createSelectFilter:function(e){var t=this.options.filters[e],n={},r=[],i=!1,s=!0,o=this.options.filterEmptySelect,u=!1;t instanceof HTMLSelectElement?u=t:t instanceof Object&&"element"in t&&t.element&&(u=t.element);if(t instanceof HTMLSelectElement||t==="select")n=this.getFilterOptions(e);else{i="multiple"in t&&t.multiple===!0,s="empty"in t&&t.empty,o="empty"in t&&typeof t.empty=="string"?t.empty:this.options.filterEmptySelect;if("values"in t){t.values==="auto"?n=this.getFilterOptions(e):n=t.values;if("default"in t)r=t["default"];else if(i){r=[];for(var a in n)n[a]instanceof Object?r=r.concat(this._keys(n[a])):r.push(a)}else r=[];r instanceof Array||(r=[r])}else n=t,r=i?this._keys(n):[]}var f=u?u:document.createElement("select");i&&(f.multiple=!0),t["default"]&&(f.dataset["default"]=t["default"]),this.addClass(f,"datatable-filter datatable-select"),f.dataset.filter=e;if(s){var l=document.createElement("option");l.dataset.empty=!0,l.value="",l.innerHTML=o,f.appendChild(l)}var c=[];for(var h in n)if(n[h]instanceof Object){var p=document.createElement("optgroup");p.label=h;for(var d in n[h])if(n[h].hasOwnProperty(d)){c.push(d);var l=document.createElement("option");l.value=d,l.selected=this._isIn(d,r),l.innerHTML=n[h][d],p.appendChild(l)}f.appendChild(p)}else{c.push(h);var l=document.createElement("option");l.value=h,l.selected=this._isIn(h,r),l.innerHTML=n[h],f.appendChild(l)}var v=f.value;if(i){v=[];for(var m=0;m<f.options.length;++m)f.options[m].selected&&v.push(f.options[m].value)}return this.filterVals[e]=i?v:s&&!v?c:[v],f.onchange=function(e,t,n,r){return function(){var i=this.value;if(t){i=[];for(var s=0;s<this.options.length;++s)this.options[s].selected&&i.push(this.options[s].value)}var o=this.dataset.filter;r.filterVals[o]=t?i:n&&!i?e:[i],r.filter()}}(c,i,s,this),t instanceof Object&&t.fn instanceof Function?(this.addFilter(e,t.fn),f.dataset.filterType="function"):(this.addFilter(e,function(e,t){return function(n,r){return r?r==e&&!n?!0:t._isIn(n,r):!1}}(c,this)),f.dataset.filterType="default"),this.addClass(f,this.options.filterSelectClass),f},createFilter:function(){this.filters=[],this.filterTags=[],this.filterVals=[];if(this.options.filters==="*"){var e=this.table.tHead.rows[0].cells.length;this.options.filters=[];while(e--)this.options.filters.push(!0)}if(this.options.filters){var t=!1,n=document.createElement("tr");n.classList.add("datatable-filter-line");for(var r in this.options.filters)if(this.options.filters.hasOwnProperty(r)){var i=document.createElement("td");if(this.options.filters[r]!==!1){var s=this.options.filters[r],o=s===!0||s==="regexp"||s==="input"||s instanceof Function||s instanceof HTMLInputElement,u=o?this.createTextFilter(r):this.createSelectFilter(r);this.filterTags[r]=u,document.contains(u)||(i.classList.add("datatable-filter-cell"),i.appendChild(u))}(!(this.options.filters[r]instanceof Object)||!this.options.filters[r].noColumn)&&n.appendChild(i)}n.querySelectorAll("td.datatable-filter-cell").length>0&&this.table.tHead.appendChild(n)}},filter:function(e){typeof e=="undefined"&&(e=!1);var t=this.currentStart;this.currentStart=0,this.filterIndex=[];for(var n=0;n<this.data.length;n++)this.checkFilter(this.data[n])&&this.filterIndex.push(n);if(e){this.currentStart=t;while(this.currentStart>=this.filterIndex.length)this.currentStart-=this.options.pageSize;this.currentStart<0&&(this.currentStart=0)}if(this.options.filterSelectOptions&&this.filterIndex.length>0){var r=this,i=[];for(var s=0;s<this.data[0].length;++s)i.push({});for(var n=0;n<this.filterIndex.length;++n){var o=this.data[this.filterIndex[n]];for(var s=0;s<o.length;++s)i[s][o[s]]=!0}for(var u=0;u<i.length;++u){var a=this._keys(i[u]);if(this.filterTags[u]&&this.filterTags[u]instanceof HTMLSelectElement&&this.filterTags[u].dataset.filterType=="default"){var f=this.filterTags[u].childNodes;for(var n=0;n<f.length;++n)f[n].dataset.empty||(f[n].style.display=r._isIn(f[n].value,a)?"block":"none")}}}this.refresh()},resetFilters:function(){var e=this;this.filterTags.forEach(function(t){var n=t.dataset.filter;if(t instanceof HTMLInputElement)t.value="",e.filterVals[n]="";else if(t.multiple){var r=[];for(var i=0;i<t.childNodes.length;++i)t.childNodes[i].selected=!0,r.push(t.childNodes[i].value);e.filterVals[n]=r}else if(t.dataset["default"]&&t.querySelector('option[value="'+t.dataset["default"]+'"]').length>0){for(var i=0;i<t.childNodes.length;++i)t.childNodes[i].selected=t.childNodes[i].value==t.dataset["default"];e.filterVals[n]=[t.dataset["default"]]}else if(t.childNodes.length>0){t.childNodes[0].selected=!0;for(var i=1;i<t.childNodes.length;++i)t.childNodes[i].selected=!1;if(t.childNodes[0].dataset.empty){var r=[];for(var i=1;i<t.childNodes.length;++i)r.push(t.childNodes[i].value);e.filterVals[n]=r}else e.filterVals[n]=[t.childNodes[0].value]}}),this.filter()},stripTags:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText},checkFilter:function(e){var t=!0;for(var n in this.filters){var r=n[0]==="_"?e:e[n];typeof r=="string"&&(r=this.stripTags(r));if(!this.filters[n](r,this.filterVals[n])){t=!1;break}}return t},addFilter:function(e,t){this.filters[e]=t},getFilterOptions:function(e){var t={},n=[];for(var r in this.data)this.data[r][e]!==""&&n.push(this.data[r][e]);n.sort();for(var i in n)if(n.hasOwnProperty(i)){var s=this.stripTags(n[i]);t[s]=s}return t},destroySort:function(){$("thead th").removeClass("sorting sorting-asc sorting-desc").unbind("click.datatable").removeData("sort")},createSort:function(){var e=this;if(!(this.options.sort instanceof Function)){var t=0,n=this.table.tHead.rows[0].cells;for(var r=0;r<n.length;++r){if(n[r].dataset.sort)e.options.sort=!0;else if(e.options.sort==="*")n[r].dataset.sort=t;else{var i;e.options.sort instanceof Array?i=t:e.options.sort instanceof Object&&(i=e._keys(e.options.sort)[t]),i!==undefined&&e.options.sort[i]&&(n[r].dataset.sort=i)}n[r].dataset.sort!==undefined&&n[r].classList.add("sorting"),t++,n[r].addEventListener("click",function(){if(this.dataset.sort){if(this.classList.contains("sorting-asc"))e.options.sortDir="desc",this.classList.remove("sorting-asc"),this.classList.add("sorting-desc");else if(this.classList.contains("sorting-desc"))e.options.sortDir="asc",this.classList.remove("sorting-desc"),this.classList.add("sorting-asc");else{var t=this.parentNode.cells;for(var n=0;n<t.length;n++)t[n].classList.remove("sorting-desc"),t[n].classList.remove("sorting-asc");e.options.sortDir="asc",e.options.sortKey=this.dataset.sort,this.classList.add("sorting-asc")}e.sort(),e.refresh()}},!1)}}},triggerSort:function(){if(this.options.sort instanceof Function)this.sort(),this.refresh();else if(this.options.sortKey!==!1){var e=this.table.tHead.rows[0].cells,t;for(var n=0;n<e.length;n++)e[n].classList.remove("sorting-desc"),e[n].classList.remove("sorting-asc"),e[n].dataset.sort===this.options.sortKey&&(t=e[n]);t!==undefined&&(t.classList.add("sorting-"+this.options.sortDir),this.sort(),this.refresh())}},sort:function(e){var t=this.getSortFunction();t!==!1&&this.data.sort(t),this.filter(e)},identify:function(e,t){return this.options.identify===!1?!1:this.options.identify instanceof Function?this.options.identify(e,t):t[this.options.identify]==e},indexOf:function(e){var t=-1;for(var n=0;n<this.data.length&&t===-1;n++)this.identify(e,this.data[n])&&(t=n);return t},row:function(e){return this.options.identify===!0?this.data[e]:this.data[this.indexOf(e)]},all:function(e){if(typeof e=="undefined"||e===!0)return this.data;var t=[];for(var n=0;n<this.data.length;++n)e(this.data[n])&&t.push(this.data[n]);return t},addRow:function(e){this.data.push(e),typeof this.syncData!="undefined"&&this.syncData.toAdd.push(e),this.sort(),this.filter(),this.currentStart=parseInt(this._index(this._index(e,this.data),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()},addRows:function(e){this.data=this.data.concat(e),typeof this.syncData!="undefined"&&(this.syncData.toAdd=this.syncData.toAdd.concat(e)),this.sort(),this.filter(),this.currentStart=parseInt(this._index(this._index(e,this.data),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()},deleteRow:function(e){var t=this.currentStart,n=this.indexOf(e);if(n===-1){console.log("No data found with id: "+e);return}this.data.splice(n,1),typeof this.syncData!="undefined"&&this.syncData.toDelete.push(e),this.filter(),t<this.filterIndex.length?this.currentStart=t:(this.currentStart=t-this.options.pageSize,this.currentStart<0&&(this.currentStart=0)),this.refresh()},deleteAll:function(e){var t=this.currentStart,n=[];typeof this.syncData!="undefined"&&this.syncData.toDelete.push(e);for(var r=0;r<this.data.length;++r)e(this.data[r])||n.push(this.data[r]);this.data=n,this.filter(),t<this.filterIndex.length?this.currentStart=t:(this.currentStart=t-this.options.pageSize,this.currentStart<0&&(this.currentStart=0)),this.refresh()},updateRow:function(e,t){var n=this.indexOf(e);typeof this.syncData!="undefined"&&(this.syncData.toUpdate[e]=t);if(n!==-1){e in t&&delete t[e];for(var r in this.data[n])r in t&&(this.data[n][r]=t[r]);this.sort(),this.filter(),this.currentStart=parseInt(this._index(this.indexOf(e),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()}},loadPage:function(e){var t=this.currentStart/this.options.pageSize;e<1?e=1:e>this.getLastPageNumber()&&(e=this.getLastPageNumber()),this.currentStart=(e-1)*this.options.pageSize,this.refresh(),this.options.onChange.call(this.table,t+1,e)},getCurrentPage:function(){return this.currentStart/this.options.pageSize+1},refresh:function(){this.options.beforeRefresh.call(this.table),this.updatePaging(),this.updateCounter(),this.removeNode(this.table.tBodies[0]),this.table.appendChild(document.createElement("tbody"));if(this.currentStart>=this.currentDataLength){this.table.tBodies[0].innerHTML='<tr><td colspan="'+this.options.nbColumns+'">'+'<div class="progress progress-striped active">'+'<div class="bar" style="width: 100%;"></div>'+"</div></div></tr>";return}for(var e=0;e<this.options.pageSize&&e+this.currentStart<this.filterIndex.length;e++){var t=this.filterIndex[this.currentStart+e],n=this.data[t];this.table.tBodies[0].appendChild(this.options.lineFormat.call(this.table,t,n))}this.options.afterRefresh.call(this.table)},setOption:function(e,t){e in this.options&&(this.options[e]=t,e==="sort"&&(this.destroySort(),this.createSort(),this.triggerSort()),(e==="sortKey"||e==="sortDir")&&this.sort(),e==="filters"&&(this.destroyFilter(),this.createFilter()),e==="filterText"&&this.changePlaceHolder(),this.filter())},setOptions:function(e){for(var t in e)t in this.options&&(this.options[t]=e[t]);"sort"in e?(this.destroySort(),this.createSort(),this.triggerSort()):("sortKey"in e||"sortDir"in e)&&this.sort(),"filters"in e&&(this.destroyFilter(),this.createFilter()),"filterText"in e&&this.changePlaceHolder(),this.filter()},destroy:function(){this.refreshTimeOut!==undefined&&clearTimeout(this.refreshTimeOut),this.destroySort();for(var e=0;e<this.pagingDivs.length;++e)this.pagingDivs[e].classList.remove("pagination-datatable"),this.pagingDivs[e].classList.remove(this.options.pagingDivClass),this.pagingDivs[e].innerHTML="";this.destroyFilter(),this.table.classList.remove(this.options.tableClass),this.removeNode(this.table.tBodies[0]),this.table.appendChild(document.createElement("tbody"));for(var e=0;e<this.data.length;e++){var t=this.filterIndex[this.currentStart+e],n=this.data[t];this.table.tBodies[0].appendChild(this.options.lineFormat.call(this.table,t,n))}}},DataTable.defaultOptions={forceStrings:!1,tableClass:"datatable",pagingDivSelector:".paging",pagingDivClass:"text-center",pagingListClass:"pagination",counterDivSelector:".counter",loadingDivSelector:".loading",sort:!1,sortKey:!1,sortDir:"asc",nbColumns:-1,pageSize:20,pagingNumberOfPages:9,identify:!1,onChange:function(e,t){},counterText:function(e,t,n,r,i,s){var o="Page "+e+" on "+t+". Showing "+n+" to "+r+" of "+i+" entries";return i!=s&&(o+=" (filtered from "+s+" total entries)"),o+=".",o},firstPage:"&lt;&lt;",prevPage:"&lt;",pagingPages:!1,nextPage:"&gt;",lastPage:"&gt;&gt;",dataTypes:!0,filters:{},filterText:"Search... ",filterEmptySelect:"",filterSelectOptions:!1,filterInputClass:"form-control",filterSelectClass:"form-control",beforeRefresh:function(){},afterRefresh:function(){},lineFormat:function(e,t){var n=document.createElement("tr");n.dataset.id=e;for(var r in t)t.hasOwnProperty(r)&&(n.innerHTML+="<td>"+t[r]+"</td>");return n}},DataTable.defaultAjaxOptions={url:null,size:null,refresh:!1,allInOne:!1,timeout:2e3};
>>>>>>> Fix filter -> filters.
=======
"use strict";var DataTable=function(e,t){this.options={},this.table=e,this.currentPage=0,this.currentStart=0,this.filterIndex=[];for(var n in DataTable.defaultOptions)DataTable.defaultOptions.hasOwnProperty(n)&&(t.hasOwnProperty(n)?this.options[n]=t[n]:this.options[n]=DataTable.defaultOptions[n]);t.hasOwnProperty("data")&&(this.options.data=t.data),this.options.nbColumns<0&&(this.options.nbColumns=this.table.tHead.rows[0].cells.length),this.pagingDivs=document.querySelectorAll(this.options.pagingDivSelector);for(var r=0;r<this.pagingDivs.length;++r){var i=this.pagingDivs[r];this.addClass(i,"pagination-datatables"),this.addClass(i,this.options.pagingDivClass);var s=document.createElement("ul");this.addClass(s,this.options.pagingListClass),i.appendChild(s)}this.pagingLists=document.querySelectorAll(this.options.pagingDivSelector+" ul"),this.counterDivs=document.querySelectorAll(this.options.counterDivSelector),this.loadingDiv=document.querySelector(this.options.loadingDivSelector);var o=this;this.table.tHead||(this.table.tHead=document.createElement("thead"),this.table.appendChild(this.table.rows[0])),this.options.forceStrings&&(this.options.dataTypes=!1);var u=this.table.tHead.rows[0].cells;this.table.tBodies[0]||(this.table.tBodies[0]=document.createElement("tbody"));if(this.options.data instanceof Array)this.data=this.options.data;else if(this.options.data instanceof Object){var a=DataTable.defaultAjaxOptions;for(var n in this.options.data)a[n]=this.options.data[n];this.options.data=a;var f=!0;if(f){this.table.dataset.size!==undefined&&(this.options.data.size=parseInt(this.table.dataset.size,10)),this.data=[];if(this.options.data.size!==undefined){this.loadingDiv.innerHTML='<div class="progress datatable-load-bar"><div class="progress-bar progress-bar-striped active" style="width: 0%;"></div></div>';if(this.options.data.allInOne)this.getAjaxDataAsync(!0);else for(var r=0;r<this.options.data.size;r+=this.options.pageSize*this.options.pagingNumberOfPages)this.getAjaxDataAsync(r)}else this.loadingDiv.innerHTML='<div class="progress datatable-load-bar"><div class="progress-bar progress-bar-striped active" style="width: 0%;"></div></div>',this.getAjaxDataAsync(0,!0)}}else if(this.table.tBodies[0].rows.length>0){this.data=[];var l=this.table.tBodies[0].rows,c=l[0].cells.length;for(var r=0;r<l.length;++r)this.data.push([]);for(var h=0;h<c;++h){var p=function(e){return e};if(this.options.dataTypes instanceof Array)switch(this.options.dataTypes[h]){case"int":p=parseInt;break;case"float":case"double":p=parseFloat;break;case"date":case"datetime":p=function(e){return new Date(e)};break;case!1:case!0:case"string":case"str":p=function(e){return e};break;default:p=this.options.dataTypes[h]}for(var r=0;r<l.length;++r)this.data[r].push(p(l[r].cells[h].innerHTML.trim()))}if(this.options.dataTypes===!0)for(var d=0;d<this.data[0].length;++d){var v=!0;for(var r=0;r<this.data.length;++r)this.data[r][d]!==""&&!(this.data[r][d]-parseFloat(this.data[r][d])+1>=0)&&(v=!1);if(v)for(var r=0;r<this.data.length;++r)this.data[r][d]!==""&&(this.data[r][d]=parseFloat(this.data[r][d]))}}this.createSort(),this.createFilter(),this.triggerSort(),this.filter()};DataTable.prototype={constructor:DataTable,addClass:function(e,t){typeof t=="string"&&(t=t.split(" ")),t.forEach(function(t){if(!t)return;e.classList.add(t)})},removeNode:function(e){e&&e.parentNode.removeChild(e)},setRefreshTimeout:function(){this.options.data.refresh&&(clearTimeout(this.refreshTimeOut),this.refreshTimeOut=setTimeout(function(e){return function(){e.getAjaxDataAsync(0,!0)}}(this),this.options.data.refresh))},hideLoadingDivs:function(){this.removeNode(this.loadingDiv)},updateLoadingDivs:function(){this.data.length>=this.options.data.size?(this.setRefreshTimeout(),this.hideLoadingDivs()):this.loadingDiv.querySelector("div.progress .progress-bar").style.width=parseInt(100*this.data.length/this.options.data.size,10)+"%"},getAjaxDataAsync:function(e,t){typeof t=="undefined"&&(t=!1),t&&typeof this.syncData=="undefined"&&(this.syncData={data:[],toAdd:[],toUpdate:{},toDelete:[]});var n=new XMLHttpRequest;n.timeout=this.options.data.timeout,n.onreadystatechange=function(e,t,r){return function(){if(this.readyState==4)switch(this.status){case 200:if(r)if(this.response.length>0)e.syncData.data=e.syncData.data.concat(this.response),e.getAjaxDataAsync(t+e.options.pageSize*e.options.pagingNumberOfPages,!0);else{var i=e.syncData;delete e.syncData,e.data=i.data,e.addRows(i.toAdd),i.toDelete.forEach(function(t){t instanceof Function?e.deleteAll(t):e.deleteRow(t)});for(var s in i.toUpdate)e.updateRow(s,i.toUpdate[s]);e.sort(!0),e.setRefreshTimeout()}else e.data=e.data.concat(this.response),e.updateLoadingDivs(),e.sort(!0);break;case 404:case 500:console.log("ERROR: "+this.status+" - "+this.statusText),console.log(n);break;default:e.getAjaxDataAsync(t,r)}}}(this,e,t);var r=this.options.data.url,i=this.options.pageSize*this.options.pagingNumberOfPages,s=new FormData;e!==!0&&(this.options.data.type.toUpperCase()=="GET"?r+="?start="+e+"&limit="+i:(s.append("offset",e),s.append("limit",i))),n.open(this.options.data.type,r,!0),n.responseType="json",n.send(s)},getLastPageNumber:function(){return parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10)},updatePaging:function(){var e=this.options.pagingNumberOfPages,t=this,n=parseInt(this.currentStart/this.options.pageSize,10)+1,r=this.getLastPageNumber(),i,s,o=this.filterIndex.length?this.currentStart+1:0,u=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;n<e/2?i=1:n>=r-e/2?(i=r-e+1,i<1&&(i=1)):i=parseInt(n-e/2+1,10),i+e<r+1?s=i+e-1:s=r;for(var a=0;a<this.pagingLists.length;++a){var f=[];if(t.options.firstPage){var l=document.createElement("li");n===1&&l.classList.add("active"),l.innerHTML='<a data-page="first">'+t.options.firstPage+"</a>",f.push(l)}if(t.options.prevPage){var l=document.createElement("li");n===1&&l.classList.add("active"),l.innerHTML='<a data-page="prev">'+t.options.prevPage+"</a>",f.push(l)}if(t.options.pagingPages){var c=this.options.pagingPages.call(this.table,i,s,n,o,u);c instanceof Array?f=f.concat(c):f.push(c)}else for(var h=i;h<=s;h++){var l=document.createElement("li");h===n&&l.classList.add("active"),l.innerHTML='<a data-page="'+h+'">'+h+"</a>",f.push(l)}if(t.options.nextPage){var l=document.createElement("li");(n===r||r===0)&&l.classList.add("active"),l.innerHTML='<a data-page="next">'+t.options.nextPage+"</a>",f.push(l)}if(t.options.lastPage){var l=document.createElement("li");(n===r||r===0)&&l.classList.add("active"),l.innerHTML='<a data-page="last">'+t.options.lastPage+"</a>",f.push(l)}this.pagingLists[a].innerHTML="",f.forEach(function(e){e.childNodes.length>0&&e.childNodes[0].addEventListener("click",function(){if(this.parentNode.classList.contains("active")||typeof this.dataset.page=="undefined")return;switch(this.dataset.page){case"first":t.loadPage(1);break;case"prev":t.loadPage(n-1);break;case"next":t.loadPage(n+1);break;case"last":t.loadPage(r);break;default:t.loadPage(parseInt(parseInt(this.dataset.page),10))}},!1),this.pagingLists[a].appendChild(e)},this)}},updateCounter:function(){var e=this.filterIndex.length?parseInt(this.currentStart/this.options.pageSize,10)+1:0,t=parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10),n=this.filterIndex.length?this.currentStart+1:0,r=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;for(var i=0;i<this.counterDivs.length;++i)this.counterDivs[i].innerHTML=this.options.counterText.call(this.table,e,t,n,r,this.filterIndex.length,this.data.length)},getSortFunction:function(){if(this.options.sort===!1)return!1;if(this.options.sort instanceof Function)return this.options.sort;if(this.data.length!==0&&this.options.sortKey in this.data[0]){var e=this.options.sortKey,t=this.options.sortDir==="asc";return this.options.sort[e]instanceof Function?function(n){return function(r,i){var o=r[e],u=i[e];return t?n(o,u):-n(o,u)}}(this.options.sort[e]):function(n,r){var i=n[e],s=r[e];return i>s?t?1:-1:i<s?t?-1:1:0}}return!1},destroyFilter:function(){this.removeNode(this.table.querySelector(".datatable-filter-line"))},changePlaceHolder:function(){var e=this.options.filterText?this.options.filterText:"",t=this.table.querySelectorAll('.datatable-filter-line input[type="text"]');for(var n=0;n<t.length;++n)t[n].placeholder=e},createTextFilter:function(e){var t=this.options.filters[e],n=t instanceof HTMLInputElement?t:document.createElement("input");n.type="text",this.options.filterText&&(n.placeholder=this.options.filterText),this.addClass(n,"datatable-filter datatable-input-text"),n.dataset.filter=e,this.filterVals[e]="";var r=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}();n.onkeyup=function(e){return function(){var t=this.value.toUpperCase(),n=this.dataset.filter;r(function(){e.filterVals[n]=t,e.filter()},300)}}(this),n.onkeydown=n.onkeyup;var i=t==="regexp"||n.dataset.regexp;return t instanceof Function?this.addFilter(e,t):i?this.addFilter(e,function(e,t){return(new RegExp(t)).test(String(e))}):this.addFilter(e,function(e,t){return String(e).toUpperCase().indexOf(t)!==-1}),this.addClass(n,this.options.filterInputClass),n},_isIn:function(e,t){var n=!1;for(var r=0;r<t.length&&!n;++r)n=t[r]==e;return n},_index:function(e,t){if(t===undefined||t===null)return-1;var n=-1;for(var r=0;r<t.length&&n==-1;++r)t[r]===e&&(n=r);return n},_keys:function(e){if(e===undefined||e===null)return undefined;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},createSelectFilter:function(e){var t=this.options.filters[e],n={},r=[],i=!1,s=!0,o=this.options.filterEmptySelect,u=!1;t instanceof HTMLSelectElement?u=t:t instanceof Object&&"element"in t&&t.element&&(u=t.element);if(t instanceof HTMLSelectElement||t==="select")n=this.getFilterOptions(e);else{i="multiple"in t&&t.multiple===!0,s="empty"in t&&t.empty,o="empty"in t&&typeof t.empty=="string"?t.empty:this.options.filterEmptySelect;if("values"in t){t.values==="auto"?n=this.getFilterOptions(e):n=t.values;if("default"in t)r=t["default"];else if(i){r=[];for(var a in n)n[a]instanceof Object?r=r.concat(this._keys(n[a])):r.push(a)}else r=[];r instanceof Array||(r=[r])}else n=t,r=i?this._keys(n):[]}var f=u?u:document.createElement("select");i&&(f.multiple=!0),t["default"]&&(f.dataset["default"]=t["default"]),this.addClass(f,"datatable-filter datatable-select"),f.dataset.filter=e;if(s){var l=document.createElement("option");l.dataset.empty=!0,l.value="",l.innerHTML=o,f.appendChild(l)}var c=[];for(var h in n)if(n[h]instanceof Object){var p=document.createElement("optgroup");p.label=h;for(var d in n[h])if(n[h].hasOwnProperty(d)){c.push(d);var l=document.createElement("option");l.value=d,l.selected=this._isIn(d,r),l.innerHTML=n[h][d],p.appendChild(l)}f.appendChild(p)}else{c.push(h);var l=document.createElement("option");l.value=h,l.selected=this._isIn(h,r),l.innerHTML=n[h],f.appendChild(l)}var v=f.value;if(i){v=[];for(var m=0;m<f.options.length;++m)f.options[m].selected&&v.push(f.options[m].value)}return this.filterVals[e]=i?v:s&&!v?c:[v],f.onchange=function(e,t,n,r){return function(){var i=this.value;if(t){i=[];for(var s=0;s<this.options.length;++s)this.options[s].selected&&i.push(this.options[s].value)}var o=this.dataset.filter;r.filterVals[o]=t?i:n&&!i?e:[i],r.filter()}}(c,i,s,this),t instanceof Object&&t.fn instanceof Function?(this.addFilter(e,t.fn),f.dataset.filterType="function"):(this.addFilter(e,function(e,t){return function(n,r){return r?r==e&&!n?!0:t._isIn(n,r):!1}}(c,this)),f.dataset.filterType="default"),this.addClass(f,this.options.filterSelectClass),f},createFilter:function(){this.filters=[],this.filterTags=[],this.filterVals=[];if(this.options.filters==="*"){var e=this.table.tHead.rows[0].cells.length;this.options.filters=[];while(e--)this.options.filters.push(!0)}if(this.options.filters){var t=!1,n=document.createElement("tr");n.classList.add("datatable-filter-line");for(var r in this.options.filters)if(this.options.filters.hasOwnProperty(r)){var i=document.createElement("td");if(this.options.filters[r]!==!1){var s=this.options.filters[r],o=s===!0||s==="regexp"||s==="input"||s instanceof Function||s instanceof HTMLInputElement,u=o?this.createTextFilter(r):this.createSelectFilter(r);this.filterTags[r]=u,document.contains(u)||(i.classList.add("datatable-filter-cell"),i.appendChild(u))}(!(this.options.filters[r]instanceof Object)||!this.options.filters[r].noColumn)&&n.appendChild(i)}n.querySelectorAll("td.datatable-filter-cell").length>0&&this.table.tHead.appendChild(n)}},filter:function(e){typeof e=="undefined"&&(e=!1);var t=this.currentStart;this.currentStart=0,this.filterIndex=[];for(var n=0;n<this.data.length;n++)this.checkFilter(this.data[n])&&this.filterIndex.push(n);if(e){this.currentStart=t;while(this.currentStart>=this.filterIndex.length)this.currentStart-=this.options.pageSize;this.currentStart<0&&(this.currentStart=0)}if(this.options.filterSelectOptions&&this.filterIndex.length>0){var r=this,i=[];for(var s=0;s<this.data[0].length;++s)i.push({});for(var n=0;n<this.filterIndex.length;++n){var o=this.data[this.filterIndex[n]];for(var s=0;s<o.length;++s)i[s][o[s]]=!0}for(var u=0;u<i.length;++u){var a=this._keys(i[u]);if(this.filterTags[u]&&this.filterTags[u]instanceof HTMLSelectElement&&this.filterTags[u].dataset.filterType=="default"){var f=this.filterTags[u].childNodes;for(var n=0;n<f.length;++n)f[n].dataset.empty||(f[n].style.display=r._isIn(f[n].value,a)?"block":"none")}}}this.refresh()},resetFilters:function(){var e=this;this.filterTags.forEach(function(t){var n=t.dataset.filter;if(t instanceof HTMLInputElement)t.value="",e.filterVals[n]="";else if(t.multiple){var r=[];for(var i=0;i<t.childNodes.length;++i)t.childNodes[i].selected=!0,r.push(t.childNodes[i].value);e.filterVals[n]=r}else if(t.dataset["default"]&&t.querySelector('option[value="'+t.dataset["default"]+'"]').length>0){for(var i=0;i<t.childNodes.length;++i)t.childNodes[i].selected=t.childNodes[i].value==t.dataset["default"];e.filterVals[n]=[t.dataset["default"]]}else if(t.childNodes.length>0){t.childNodes[0].selected=!0;for(var i=1;i<t.childNodes.length;++i)t.childNodes[i].selected=!1;if(t.childNodes[0].dataset.empty){var r=[];for(var i=1;i<t.childNodes.length;++i)r.push(t.childNodes[i].value);e.filterVals[n]=r}else e.filterVals[n]=[t.childNodes[0].value]}}),this.filter()},stripTags:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText},checkFilter:function(e){var t=!0;for(var n in this.filters){var r=n[0]==="_"?e:e[n];typeof r=="string"&&(r=this.stripTags(r));if(!this.filters[n](r,this.filterVals[n])){t=!1;break}}return t},addFilter:function(e,t){this.filters[e]=t},getFilterOptions:function(e){var t={},n=[];for(var r in this.data)this.data[r][e]!==""&&n.push(this.data[r][e]);n.sort();for(var i in n)if(n.hasOwnProperty(i)){var s=this.stripTags(n[i]);t[s]=s}return t},destroySort:function(){$("thead th").removeClass("sorting sorting-asc sorting-desc").unbind("click.datatable").removeData("sort")},createSort:function(){var e=this;if(!(this.options.sort instanceof Function)){var t=0,n=this.table.tHead.rows[0].cells;for(var r=0;r<n.length;++r){if(n[r].dataset.sort)e.options.sort=!0;else if(e.options.sort==="*")n[r].dataset.sort=t;else{var i;e.options.sort instanceof Array?i=t:e.options.sort instanceof Object&&(i=e._keys(e.options.sort)[t]),i!==undefined&&e.options.sort[i]&&(n[r].dataset.sort=i)}n[r].dataset.sort!==undefined&&n[r].classList.add("sorting"),t++,n[r].addEventListener("click",function(){if(this.dataset.sort){if(this.classList.contains("sorting-asc"))e.options.sortDir="desc",this.classList.remove("sorting-asc"),this.classList.add("sorting-desc");else if(this.classList.contains("sorting-desc"))e.options.sortDir="asc",this.classList.remove("sorting-desc"),this.classList.add("sorting-asc");else{var t=this.parentNode.cells;for(var n=0;n<t.length;n++)t[n].classList.remove("sorting-desc"),t[n].classList.remove("sorting-asc");e.options.sortDir="asc",e.options.sortKey=this.dataset.sort,this.classList.add("sorting-asc")}e.sort(),e.refresh()}},!1)}}},triggerSort:function(){if(this.options.sort instanceof Function)this.sort(),this.refresh();else if(this.options.sortKey!==!1){var e=this.table.tHead.rows[0].cells,t;for(var n=0;n<e.length;n++)e[n].classList.remove("sorting-desc"),e[n].classList.remove("sorting-asc"),e[n].dataset.sort===this.options.sortKey&&(t=e[n]);t!==undefined&&(t.classList.add("sorting-"+this.options.sortDir),this.sort(),this.refresh())}},sort:function(e){var t=this.getSortFunction();t!==!1&&this.data.sort(t),this.filter(e)},identify:function(e,t){return this.options.identify===!1?!1:this.options.identify instanceof Function?this.options.identify(e,t):t[this.options.identify]==e},indexOf:function(e){var t=-1;for(var n=0;n<this.data.length&&t===-1;n++)this.identify(e,this.data[n])&&(t=n);return t},row:function(e){return this.options.identify===!0?this.data[e]:this.data[this.indexOf(e)]},all:function(e){if(typeof e=="undefined"||e===!0)return this.data;var t=[];for(var n=0;n<this.data.length;++n)e(this.data[n])&&t.push(this.data[n]);return t},addRow:function(e){this.data.push(e),typeof this.syncData!="undefined"&&this.syncData.toAdd.push(e),this.sort(),this.filter(),this.currentStart=parseInt(this._index(this._index(e,this.data),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()},addRows:function(e){this.data=this.data.concat(e),typeof this.syncData!="undefined"&&(this.syncData.toAdd=this.syncData.toAdd.concat(e)),this.sort(),this.filter(),this.currentStart=parseInt(this._index(this._index(e,this.data),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()},deleteRow:function(e){var t=this.currentStart,n=this.indexOf(e);if(n===-1){console.log("No data found with id: "+e);return}this.data.splice(n,1),typeof this.syncData!="undefined"&&this.syncData.toDelete.push(e),this.filter(),t<this.filterIndex.length?this.currentStart=t:(this.currentStart=t-this.options.pageSize,this.currentStart<0&&(this.currentStart=0)),this.refresh()},deleteAll:function(e){var t=this.currentStart,n=[];typeof this.syncData!="undefined"&&this.syncData.toDelete.push(e);for(var r=0;r<this.data.length;++r)e(this.data[r])||n.push(this.data[r]);this.data=n,this.filter(),t<this.filterIndex.length?this.currentStart=t:(this.currentStart=t-this.options.pageSize,this.currentStart<0&&(this.currentStart=0)),this.refresh()},updateRow:function(e,t){var n=this.indexOf(e);typeof this.syncData!="undefined"&&(this.syncData.toUpdate[e]=t);if(n!==-1){e in t&&delete t[e];for(var r in this.data[n])r in t&&(this.data[n][r]=t[r]);this.sort(),this.filter(),this.currentStart=parseInt(this._index(this.indexOf(e),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()}},loadPage:function(e){var t=this.currentStart/this.options.pageSize;e<1?e=1:e>this.getLastPageNumber()&&(e=this.getLastPageNumber()),this.currentStart=(e-1)*this.options.pageSize,this.refresh(),this.options.onChange.call(this.table,t+1,e)},getCurrentPage:function(){return this.currentStart/this.options.pageSize+1},refresh:function(){this.options.beforeRefresh.call(this.table),this.updatePaging(),this.updateCounter(),this.removeNode(this.table.tBodies[0]),this.table.appendChild(document.createElement("tbody"));if(this.currentStart>=this.currentDataLength){this.table.tBodies[0].innerHTML='<tr><td colspan="'+this.options.nbColumns+'">'+'<div class="progress progress-striped active">'+'<div class="bar" style="width: 100%;"></div>'+"</div></div></tr>";return}for(var e=0;e<this.options.pageSize&&e+this.currentStart<this.filterIndex.length;e++){var t=this.filterIndex[this.currentStart+e],n=this.data[t];this.table.tBodies[0].appendChild(this.options.lineFormat.call(this.table,t,n))}this.options.afterRefresh.call(this.table)},setOption:function(e,t){e in this.options&&(this.options[e]=t,e==="sort"&&(this.destroySort(),this.createSort(),this.triggerSort()),(e==="sortKey"||e==="sortDir")&&this.sort(),e==="filters"&&(this.destroyFilter(),this.createFilter()),e==="filterText"&&this.changePlaceHolder(),this.filter())},setOptions:function(e){for(var t in e)t in this.options&&(this.options[t]=e[t]);"sort"in e?(this.destroySort(),this.createSort(),this.triggerSort()):("sortKey"in e||"sortDir"in e)&&this.sort(),"filters"in e&&(this.destroyFilter(),this.createFilter()),"filterText"in e&&this.changePlaceHolder(),this.filter()},destroy:function(){this.refreshTimeOut!==undefined&&clearTimeout(this.refreshTimeOut),this.destroySort();for(var e=0;e<this.pagingDivs.length;++e)this.pagingDivs[e].classList.remove("pagination-datatable"),this.pagingDivs[e].classList.remove(this.options.pagingDivClass),this.pagingDivs[e].innerHTML="";this.destroyFilter(),this.table.classList.remove(this.options.tableClass),this.removeNode(this.table.tBodies[0]),this.table.appendChild(document.createElement("tbody"));for(var e=0;e<this.data.length;e++){var t=this.filterIndex[this.currentStart+e],n=this.data[t];this.table.tBodies[0].appendChild(this.options.lineFormat.call(this.table,t,n))}}},DataTable.defaultOptions={forceStrings:!1,tableClass:"datatable",pagingDivSelector:".paging",pagingDivClass:"text-center",pagingListClass:"pagination",counterDivSelector:".counter",loadingDivSelector:".loading",sort:!1,sortKey:!1,sortDir:"asc",nbColumns:-1,pageSize:20,pagingNumberOfPages:9,identify:!1,onChange:function(e,t){},counterText:function(e,t,n,r,i,s){var o="Page "+e+" on "+t+". Showing "+n+" to "+r+" of "+i+" entries";return i!=s&&(o+=" (filtered from "+s+" total entries)"),o+=".",o},firstPage:"&lt;&lt;",prevPage:"&lt;",pagingPages:!1,nextPage:"&gt;",lastPage:"&gt;&gt;",dataTypes:!0,filters:{},filterText:"Search... ",filterEmptySelect:"",filterSelectOptions:!1,filterInputClass:"form-control",filterSelectClass:"form-control",beforeRefresh:function(){},afterRefresh:function(){},lineFormat:function(e,t){var n=document.createElement("tr");n.dataset.id=e;for(var r in t)t.hasOwnProperty(r)&&(n.innerHTML+="<td>"+t[r]+"</td>");return n}},DataTable.defaultAjaxOptions={url:null,size:null,refresh:!1,allInOne:!1,timeout:2e3};
>>>>>>> 972c553c421a6d9b37b7ce76ee4583de788ee668
